services:
  backend:
    command: uvicorn backend.app:app --host ${OWUI_API_HOST:-0.0.0.0} --port ${OWUI_API_PORT:-8502} --reload
    volumes:
      - ./backend:/app/backend:rw

  frontend:
    command:
      [
        "streamlit",
        "run",
        "frontend/home.py",
        "--server.address=0.0.0.0",
        "--server.port=8501",
        "--server.headless=true",
        "--server.fileWatcherType=auto",
        "--server.runOnSave=true",
      ]
    volumes:
      - ./frontend:/app/frontend:rw
      - ./data:/app/data:rw
      - ./uploads:/app/uploads:rw
      - ./.streamlit:/app/.streamlit:ro
    environment:
      STREAMLIT_SERVER_FILE_WATCHER_TYPE: auto
      STREAMLIT_SERVER_RUN_ON_SAVE: "true"

  frontend-next:
    command: >
      sh -c "corepack enable &&
      pnpm install &&
      pnpm dev"
    env_file:
      - .env
    volumes:
      - ./frontend-next:/app:rw
      - frontend_next_node_modules:/app/node_modules
    environment:
      NODE_ENV: development
      ENV: DEV
